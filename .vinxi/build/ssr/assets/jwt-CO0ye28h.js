import t from"jsonwebtoken";const o=process.env.JWT_SECRET;if(!o)throw new Error("JWT_SECRET is not defined in environment variables");const i=o;function k(n){return t.sign(n,i,{expiresIn:"7d"})}function a(n){try{const e=t.verify(n,i);return typeof e=="object"&&e!==null&&"userId"in e&&"username"in e?e:null}catch(e){return console.error("Token verification failed:",e),null}}function l(n){const e=n.headers.get("authorization");if(e&&e.startsWith("Bearer "))return e.split(" ")[1];const r=n.headers.get("cookie");return r&&new Map(r.split("; ").map(s=>{const[u,...c]=s.split("=");return[u,c.join("=")]})).get("auth_token")||null}async function h(n){try{const e=l(n);if(!e)return console.log("No authentication token found in request"),null;const r=a(e);return r||(console.warn("Token verification failed"),null)}catch(e){return console.error("Error in getAuthUser:",e),null}}export{h as a,k as g};
