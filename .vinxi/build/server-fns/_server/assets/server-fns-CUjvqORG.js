import{fromJSON as G,crossSerializeStream as te,getCrossReferenceHeader as se}from"seroval";import{CustomEventPlugin as T,DOMExceptionPlugin as E,EventPlugin as P,FormDataPlugin as k,HeadersPlugin as v,ReadableStreamPlugin as x,RequestPlugin as H,ResponsePlugin as q,URLSearchParamsPlugin as O,URLPlugin as A}from"seroval-plugins/web";import{lazy as re,createComponent as oe,sharedConfig as W}from"solid-js";import{ssrElement as g,escape as ie,mergeProps as ae,ssr as ne,getRequestEvent as ce,isServer as pe,renderToString as ue}from"solid-js/web";import{provideRequestEvent as B}from"solid-js/web/storage";import{H3Event as j,setHeader as le,appendResponseHeader as de,getRequestIP as fe,parseCookies as me,getResponseStatus as he,getResponseStatusText as ge,getCookie as ye,setCookie as be,getResponseHeader as Re,setResponseHeader as Se,removeResponseHeader as $e,getResponseHeaders as we,getRequestURL as Te,getRequestWebStream as Ee,setResponseStatus as Pe,eventHandler as ke}from"h3";import{getContext as ve}from"unctx";import{AsyncLocalStorage as xe}from"node:async_hooks";import{createRouter as He}from"radix3";function qe(e){let s;const t=J(e),o={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(t,{...o,body:e.node.req.body}):new Request(t,{...o,get body(){return s||(s=De(e),s)}})}function Oe(e){return e.web??={request:qe(e),url:J(e)},e.web.request}function Ae(){return Xe()}const z=Symbol("$HTTPEvent");function je(e){return typeof e=="object"&&(e instanceof j||e?.[z]instanceof j||e?.__is_event__===!0)}function p(e){return function(...s){let t=s[0];if(je(t))s[0]=t instanceof j||t.__is_event__?t:t[z];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(t=Ae(),!t)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");s.unshift(t)}return e(...s)}}const J=p(Te),Ce=p(fe),R=p(Pe),I=p(he),Le=p(ge),y=p(we),U=p(Re),Fe=p(Se),Y=p(de),Ge=p(me),Ie=p(ye),Ue=p(be),b=p(le),De=p(Ee),_e=p($e),Me=p(Oe);function Ne(){return ve("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:xe})}function Xe(){return Ne().use().event}const S="Invariant Violation",{setPrototypeOf:We=function(e,s){return e.__proto__=s,e}}=Object;class C extends Error{framesToPop=1;name=S;constructor(s=S){super(typeof s=="number"?`${S}: ${s} (see https://github.com/apollographql/invariant-packages)`:s),We(this,C.prototype)}}function Be(e,s){if(!e)throw new C(s)}const $="solidFetchEvent";function ze(e){return{request:Me(e),response:Ke(e),clientAddress:Ce(e),locals:{},nativeEvent:e}}function Je(e){return{...e}}function Ye(e){if(!e.context[$]){const s=ze(e);e.context[$]=s}return e.context[$]}function D(e,s){for(const[t,o]of s.entries())Y(e,t,o)}class Ve{event;constructor(s){this.event=s}get(s){const t=U(this.event,s);return Array.isArray(t)?t.join(", "):t||null}has(s){return this.get(s)!==void 0}set(s,t){return Fe(this.event,s,t)}delete(s){return _e(this.event,s)}append(s,t){Y(this.event,s,t)}getSetCookie(){const s=U(this.event,"Set-Cookie");return Array.isArray(s)?s:[s]}forEach(s){return Object.entries(y(this.event)).forEach(([t,o])=>s(Array.isArray(o)?o.join(", "):o,t,this))}entries(){return Object.entries(y(this.event)).map(([s,t])=>[s,Array.isArray(t)?t.join(", "):t])[Symbol.iterator]()}keys(){return Object.keys(y(this.event))[Symbol.iterator]()}values(){return Object.values(y(this.event)).map(s=>Array.isArray(s)?s.join(", "):s)[Symbol.iterator]()}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}}function Ke(e){return{get status(){return I(e)},set status(s){R(e,s)},get statusText(){return Le(e)},set statusText(s){R(e,I(e),s)},headers:new Ve(e)}}const V=[{page:!0,$component:{src:"src/routes/[...404].tsx?pick=default&pick=$css",build:()=>import("../_...404_.js"),import:()=>import("../_...404_.js")},path:"/*404",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/[...404].tsx"},{page:!1,$GET:{src:"src/routes/api/admin/performance.ts?pick=GET",build:()=>import("../performance.js"),import:()=>import("../performance.js")},$HEAD:{src:"src/routes/api/admin/performance.ts?pick=GET",build:()=>import("../performance.js"),import:()=>import("../performance.js")},path:"/api/admin/performance",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/api/admin/performance.ts"},{page:!1,$POST:{src:"src/routes/api/auth/index.ts?pick=POST",build:()=>import("../index.js"),import:()=>import("../index.js")},path:"/api/auth/",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/api/auth/index.ts"},{page:!1,$POST:{src:"src/routes/api/auth/login.ts?pick=POST",build:()=>import("../login.js"),import:()=>import("../login.js")},path:"/api/auth/login",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/api/auth/login.ts"},{page:!1,$POST:{src:"src/routes/api/auth/logout.ts?pick=POST",build:()=>import("../logout.js"),import:()=>import("../logout.js")},path:"/api/auth/logout",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/api/auth/logout.ts"},{page:!1,$POST:{src:"src/routes/api/auth/register.ts?pick=POST",build:()=>import("../register.js"),import:()=>import("../register.js")},path:"/api/auth/register",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/api/auth/register.ts"},{page:!1,$GET:{src:"src/routes/api/auth/verify.ts?pick=GET",build:()=>import("../verify.js"),import:()=>import("../verify.js")},$HEAD:{src:"src/routes/api/auth/verify.ts?pick=GET",build:()=>import("../verify.js"),import:()=>import("../verify.js")},path:"/api/auth/verify",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/api/auth/verify.ts"},{page:!1,$GET:{src:"src/routes/api/base-points/count.ts?pick=GET",build:()=>import("../count.js"),import:()=>import("../count.js")},$HEAD:{src:"src/routes/api/base-points/count.ts?pick=GET",build:()=>import("../count.js"),import:()=>import("../count.js")},path:"/api/base-points/count",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/api/base-points/count.ts"},{page:!1,$DELETE:{src:"src/routes/api/base-points.ts?pick=DELETE",build:()=>import("../base-points.js"),import:()=>import("../base-points.js")},$GET:{src:"src/routes/api/base-points.ts?pick=GET",build:()=>import("../base-points2.js"),import:()=>import("../base-points2.js")},$HEAD:{src:"src/routes/api/base-points.ts?pick=GET",build:()=>import("../base-points2.js"),import:()=>import("../base-points2.js")},$POST:{src:"src/routes/api/base-points.ts?pick=POST",build:()=>import("../base-points3.js"),import:()=>import("../base-points3.js")},path:"/api/base-points",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/api/base-points.ts"},{page:!1,$POST:{src:"src/routes/api/calculate-squares.ts?pick=POST",build:()=>import("../calculate-squares.js"),import:()=>import("../calculate-squares.js")},path:"/api/calculate-squares",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/api/calculate-squares.ts"},{page:!1,$GET:{src:"src/routes/api/events.ts?pick=GET",build:()=>import("../events.js"),import:()=>import("../events.js")},$HEAD:{src:"src/routes/api/events.ts?pick=GET",build:()=>import("../events.js"),import:()=>import("../events.js")},path:"/api/events",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/api/events.ts"},{page:!1,$POST:{src:"src/routes/api/game/join.ts?pick=POST",build:()=>import("../join.js"),import:()=>import("../join.js")},path:"/api/game/join",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/api/game/join.ts"},{page:!1,$POST:{src:"src/routes/api/game/leave.ts?pick=POST",build:()=>import("../leave.js"),import:()=>import("../leave.js")},path:"/api/game/leave",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/api/game/leave.ts"},{page:!1,$GET:{src:"src/routes/api/game/status.ts?pick=GET",build:()=>import("../status.js"),import:()=>import("../status.js")},$HEAD:{src:"src/routes/api/game/status.ts?pick=GET",build:()=>import("../status.js"),import:()=>import("../status.js")},path:"/api/game/status",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/api/game/status.ts"},{page:!1,$GET:{src:"src/routes/api/map/tile/[tileX]/[tileY].ts?pick=GET",build:()=>import("../_tileY_.js"),import:()=>import("../_tileY_.js")},$HEAD:{src:"src/routes/api/map/tile/[tileX]/[tileY].ts?pick=GET",build:()=>import("../_tileY_.js"),import:()=>import("../_tileY_.js")},$OPTIONS:{src:"src/routes/api/map/tile/[tileX]/[tileY].ts?pick=OPTIONS",build:()=>import("../_tileY_2.js"),import:()=>import("../_tileY_2.js")},path:"/api/map/tile/:tileX/:tileY",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/api/map/tile/[tileX]/[tileY].ts"},{page:!1,$POST:{src:"src/routes/api/reset-game-progress.ts?pick=POST",build:()=>import("../reset-game-progress.js"),import:()=>import("../reset-game-progress.js")},path:"/api/reset-game-progress",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/api/reset-game-progress.ts"},{page:!0,$component:{src:"src/routes/game/index.tsx?pick=default&pick=$css",build:()=>import("../index2.js"),import:()=>import("../index2.js")},path:"/game/",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/game/index.tsx"},{page:!0,$component:{src:"src/routes/index.tsx?pick=default&pick=$css",build:()=>import("../index3.js"),import:()=>import("../index3.js")},path:"/",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/index.tsx"},{page:!0,$component:{src:"src/routes/login.tsx?pick=default&pick=$css",build:()=>import("../login2.js"),import:()=>import("../login2.js")},path:"/login",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/login.tsx"},{page:!0,$component:{src:"src/routes/register.tsx?pick=default&pick=$css",build:()=>import("../register2.js"),import:()=>import("../register2.js")},path:"/register",filePath:"/home/n/data/l/windsurf/solidstart/solid-project/src/routes/register.tsx"}],Qe=Ze(V.filter(e=>e.page));function Ze(e){function s(t,o,i,a){const n=Object.values(t).find(c=>i.startsWith(c.id+"/"));return n?(s(n.children||(n.children=[]),o,i.slice(n.id.length)),t):(t.push({...o,id:i,path:i.replace(/\([^)/]+\)/g,"").replace(/\/+/g,"/")}),t)}return e.sort((t,o)=>t.path.length-o.path.length).reduce((t,o)=>s(t,o,o.path,o.path),[])}function et(e){return e.$HEAD||e.$GET||e.$POST||e.$PUT||e.$PATCH||e.$DELETE}He({routes:V.reduce((e,s)=>{if(!et(s))return e;let t=s.path.replace(/\([^)/]+\)/g,"").replace(/\/+/g,"/").replace(/\*([^/]*)/g,(o,i)=>`**:${i}`).split("/").map(o=>o.startsWith(":")||o.startsWith("*")?o:encodeURIComponent(o)).join("/");if(/:[^/]*\?/g.test(t))throw new Error(`Optional parameters are not supported in API routes: ${t}`);if(e[t])throw new Error(`Duplicate API routes for "${t}" found at "${e[t].route.path}" and "${s.path}"`);return e[t]={route:s},e},{})});function tt(e){e.forEach(s=>{if(!s.attrs.href)return;let t=document.head.querySelector(`link[href="${s.attrs.href}"]`);t||(t=document.createElement("link"),t.setAttribute("rel","preload"),t.setAttribute("as","style"),t.setAttribute("href",s.attrs.href),document.head.appendChild(t))})}var st=" ";const rt={style:e=>g("style",e.attrs,()=>e.children,!0),link:e=>g("link",e.attrs,void 0,!0),script:e=>e.attrs.src?g("script",ae(()=>e.attrs,{get id(){return e.key}}),()=>ne(st),!0):null,noscript:e=>g("noscript",e.attrs,()=>ie(e.children),!0)};function ot(e,s){let{tag:t,attrs:{key:o,...i}={key:void 0},children:a}=e;return rt[t]({attrs:{...i,nonce:s},key:o,children:a})}function it(e,s,t,o="default"){return re(async()=>{{const a=(await e.import())[o],c=(await s.inputs?.[e.src].assets()).filter(d=>d.tag==="style"||d.attrs.rel==="stylesheet");return typeof window<"u"&&tt(c),{default:d=>[...c.map(m=>ot(m)),oe(a,d)]}}})}function K(){function e(t){return{...t,...t.$$route?t.$$route.require().route:void 0,info:{...t.$$route?t.$$route.require().route.info:{},filesystem:!0},component:t.$component&&it(t.$component,globalThis.MANIFEST.client,globalThis.MANIFEST.ssr),children:t.children?t.children.map(e):void 0}}return Qe.map(e)}let _;const Tt=pe?()=>ce().routes:()=>_||(_=K());function at(e){const s=Ie(e.nativeEvent,"flash");if(s)try{let t=JSON.parse(s);if(!t||!t.result)return;const o=[...t.input.slice(0,-1),new Map(t.input[t.input.length-1])],i=t.error?new Error(t.result):t.result;return{input:o,url:t.url,pending:!1,result:t.thrown?void 0:i,error:t.thrown?i:void 0}}catch(t){console.error(t)}finally{Ue(e.nativeEvent,"flash","",{maxAge:0})}}async function nt(e){const s=globalThis.MANIFEST.client;return globalThis.MANIFEST.ssr,e.response.headers.set("Content-Type","text/html"),Object.assign(e,{manifest:await s.json(),assets:[...await s.inputs[s.handler].assets()],router:{submission:at(e)},routes:K(),complete:!1,$islands:new Set})}const ct=new Set([301,302,303,307,308]);function pt(e){return e.status&&ct.has(e.status)?e.status:302}const ut={};function lt(e){const s=new TextEncoder().encode(e),t=s.length,o=t.toString(16),i="00000000".substring(0,8-o.length)+o,a=new TextEncoder().encode(`;0x${i};`),n=new Uint8Array(12+t);return n.set(a),n.set(s,12),n}function M(e,s){return new ReadableStream({start(t){te(s,{scopeId:e,plugins:[T,E,P,k,v,x,H,q,O,A],onSerialize(o,i){t.enqueue(lt(i?`(${se(e)},${o})`:o))},onDone(){t.close()},onError(o){t.error(o)}})}})}async function dt(e){const s=Ye(e),t=s.request,o=t.headers.get("X-Server-Id"),i=t.headers.get("X-Server-Instance"),a=t.headers.has("X-Single-Flight"),n=new URL(t.url);let c,l;if(o)Be(typeof o=="string","Invalid server function"),[c,l]=o.split("#");else if(c=n.searchParams.get("id"),l=n.searchParams.get("name"),!c||!l)return new Response(null,{status:404});const d=ut[c];let m;if(!d)return new Response(null,{status:404});m=await d.importer();const Q=m[d.functionName];let f=[];if(!i||e.method==="GET"){const r=n.searchParams.get("args");if(r){const u=JSON.parse(r);(u.t?G(u,{plugins:[T,E,P,k,v,x,H,q,O,A]}):u).forEach(h=>f.push(h))}}if(e.method==="POST"){const r=t.headers.get("content-type"),u=e.node.req,h=u instanceof ReadableStream,Z=u.body instanceof ReadableStream,L=h&&u.locked||Z&&u.body.locked,F=h?u:u.body;if(r?.startsWith("multipart/form-data")||r?.startsWith("application/x-www-form-urlencoded"))f.push(await(L?t:new Request(t,{...t,body:F})).formData());else if(r?.startsWith("application/json")){const ee=L?t:new Request(t,{...t,body:F});f=G(await ee.json(),{plugins:[T,E,P,k,v,x,H,q,O,A]})}}try{let r=await B(s,async()=>(W.context={event:s},s.locals.serverFunctionMeta={id:c+"#"+l},Q(...f)));if(a&&i&&(r=await X(s,r)),r instanceof Response){if(r.headers&&r.headers.has("X-Content-Raw"))return r;i&&(r.headers&&D(e,r.headers),r.status&&(r.status<300||r.status>=400)&&R(e,r.status),r.customBody?r=await r.customBody():r.body==null&&(r=null))}return i?(b(e,"content-type","text/javascript"),M(i,r)):N(r,t,f)}catch(r){if(r instanceof Response)a&&i&&(r=await X(s,r)),r.headers&&D(e,r.headers),r.status&&(!i||r.status<300||r.status>=400)&&R(e,r.status),r.customBody?r=r.customBody():r.body==null&&(r=null),b(e,"X-Error","true");else if(i){const u=r instanceof Error?r.message:typeof r=="string"?r:"true";b(e,"X-Error",u.replace(/[\r\n]+/g,""))}else r=N(r,t,f,!0);return i?(b(e,"content-type","text/javascript"),M(i,r)):r}}function N(e,s,t,o){const i=new URL(s.url),a=e instanceof Error;let n=302,c;return e instanceof Response?(c=new Headers(e.headers),e.headers.has("Location")&&(c.set("Location",new URL(e.headers.get("Location"),i.origin+"").toString()),n=pt(e))):c=new Headers({Location:new URL(s.headers.get("referer")).toString()}),e&&c.append("Set-Cookie",`flash=${encodeURIComponent(JSON.stringify({url:i.pathname+i.search,result:a?e.message:e,thrown:o,error:a,input:[...t.slice(0,-1),[...t[t.length-1].entries()]]}))}; Secure; HttpOnly;`),new Response(null,{status:n,headers:c})}let w;function ft(e){const s=new Headers(e.request.headers),t=Ge(e.nativeEvent),o=e.response.headers.getSetCookie();s.delete("cookie");let i=!1;return e.nativeEvent.node?.req&&(i=!0,e.nativeEvent.node.req.headers.cookie=""),o.forEach(a=>{if(!a)return;const n=a.split(";")[0],[c,l]=n.split("=");c&&l&&(t[c]=l)}),Object.entries(t).forEach(([a,n])=>{s.append("cookie",`${a}=${n}`),i&&(e.nativeEvent.node.req.headers.cookie+=`${a}=${n};`)}),s}async function X(e,s){let t,o=new URL(e.request.headers.get("referer")).toString();s instanceof Response&&(s.headers.has("X-Revalidate")&&(t=s.headers.get("X-Revalidate").split(",")),s.headers.has("Location")&&(o=new URL(s.headers.get("Location"),new URL(e.request.url).origin+"").toString()));const i=Je(e);return i.request=new Request(o,{headers:ft(e)}),await B(i,async()=>{await nt(i),w||(w=(await import("./app-BSWxMVrd.js")).default),i.router.dataOnly=t||!0,i.router.previousUrl=e.request.headers.get("referer");try{ue(()=>{W.context.event=i,w()})}catch(c){console.log(c)}const a=i.router.data;if(!a)return s;let n=!1;for(const c in a)a[c]===void 0?delete a[c]:n=!0;return n&&(s instanceof Response?s.customBody&&(a._$value=s.customBody()):(a._$value=s,s=new Response(null,{status:200})),s.customBody=()=>a,s.headers.set("X-Single-Flight","true")),s})}const Et=ke(dt);export{Tt as F,Et as h};
